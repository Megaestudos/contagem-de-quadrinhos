<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Contagem de Motoristas — Painel</title>
<link id="manifestPlaceholder" rel="manifest"/>
<style>
/* ===== SEU CSS ORIGINAL — NÃO ALTERADO ===== */
:root{
  --bg-1:#e8f7ff;
  --bg-2:#d8efff;
  --card-bg: rgba(255,255,255,0.72);
  --accent:#1e90ff;
  --muted:#234b60;
  --card-radius:16px;
  --shadow: 0 10px 30px rgba(11,36,64,0.10);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: "Inter","Segoe UI",Roboto,Arial,sans-serif;
  background: linear-gradient(180deg,var(--bg-1),var(--bg-2));
  color:var(--muted);
}
header{padding:26px 16px;text-align:center}
h1{margin:0;font-size:26px;color:var(--accent)}
.container{max-width:1100px;margin:18px auto 60px;padding:0 16px}
.panel{
  background:var(--card-bg);
  border-radius:var(--card-radius);
  padding:18px;
  margin:18px 0;
  box-shadow:var(--shadow);
}
.row{display:flex;gap:18px}
@media(max-width:880px){.row{flex-direction:column}}

.ranking-card{
  flex:1;border-radius:12px;padding:14px;color:#fff
}
.rank-antes{background:linear-gradient(135deg,#50a8ff,#2b9ed8)}
.rank-depois{background:linear-gradient(135deg,#00b894,#01936b)}

.rank-title{font-weight:700;margin-bottom:8px}
.rank-list{line-height:1.6}

.table-wrap{overflow:auto;margin-top:12px}
table{width:100%;border-collapse:collapse;background:#fff}
thead th{padding:12px;text-align:left}
tbody td{padding:12px;border-bottom:1px solid #eee}

.top1{
  background:rgba(255,255,255,0.15);
  padding:8px;
  border-radius:8px;
  margin-bottom:8px;
}
.muted{opacity:.7;font-size:13px}
</style>
</head>

<body>
<header><h1>Contagem de Motoristas</h1></header>

<main class="container">
  <div id="status" class="panel muted">Carregando dados da planilha...</div>

  <section class="panel">
    <div class="row">
      <div class="ranking-card rank-antes">
        <div class="rank-title">Chegadas cedo — Top 7</div>
        <div id="rankListAntes" class="rank-list"></div>
      </div>
      <div class="ranking-card rank-depois">
        <div class="rank-title">Saídas tarde — Top 7</div>
        <div id="rankListDepois" class="rank-list"></div>
      </div>
    </div>
  </section>

  <section class="panel">
    <h3>Antes do expediente</h3>
    <div class="table-wrap">
      <table id="tableAntes">
        <thead>
          <tr><th>Motorista</th><th>Data</th><th>Horário</th><th>Missão</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section class="panel">
    <h3>Depois do expediente</h3>
    <div class="table-wrap">
      <table id="tableDepois">
        <thead>
          <tr><th>Motorista</th><th>Data</th><th>Horário</th><th>Missão</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>
</main>

<script>
const SHEET_ID = "1eaFPPSEpMxsdUY9m3vT_fOhoYUKYBzATv55nRHQwyTY";
const ABA_ANTES = "ANTES DO EXPEDIENTE";
const ABA_DEPOIS = "DEPOIS DO EXPEDIENTE";
const BASE = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=`;

async function fetchSheet(aba){
  const res = await fetch(BASE + encodeURIComponent(aba));
  const txt = await res.text();
  const json = JSON.parse(txt.substring(txt.indexOf("{"), txt.lastIndexOf("}")+1));
  return json.table.rows.map(r => (r.c||[]).map(c => c?.f || c?.v || ""));
}

function normalize(rows){
  return rows.map(r=>({
    motorista: String(r[0]||"").trim(),
    data: String(r[1]||""),
    hora: String(r[2]||""),
    missao: String(r[3]||"")
  })).filter(r=>r.motorista);
}

function renderTable(id, items){
  const tb = document.querySelector(`#${id} tbody`);
  tb.innerHTML="";
  items.forEach(i=>{
    tb.innerHTML += `
      <tr>
        <td>${i.motorista}</td>
        <td>${i.data}</td>
        <td>${i.hora}</td>
        <td>${i.missao}</td>
      </tr>`;
  });
}

function renderRanking(id, items){
  const count={};
  items.forEach(i=>{
    count[i.motorista]=(count[i.motorista]||0)+1;
  });
  const rank = Object.entries(count).sort((a,b)=>b[1]-a[1]).slice(0,7);
  const el=document.getElementById(id);
  el.innerHTML="";
  rank.forEach((r,i)=>{
    el.innerHTML+=`
      <div class="${i===0?'top1':''}">
        ${i+1}. <strong>${r[0]}</strong> — ${r[1]}
      </div>`;
  });
}

async function loadAll(){
  const [a,b]=await Promise.all([
    fetchSheet(ABA_ANTES),
    fetchSheet(ABA_DEPOIS)
  ]);
  const na=normalize(a);
  const nb=normalize(b);

  renderTable("tableAntes",na);
  renderTable("tableDepois",nb);
  renderRanking("rankListAntes",na);
  renderRanking("rankListDepois",nb);

  document.getElementById("status").textContent="Dados carregados.";
}

loadAll();
</script>
</body>
</html>
