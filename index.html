<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Escala Motoristas</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background:#f5f5f5;
        margin:0;
        padding:20px;
    }
    h2 { margin-top:40px; }
    table {
        width:100%;
        border-collapse: collapse;
        background:white;
    }
    th, td {
        border:1px solid #ccc;
        padding:10px;
        text-align:left;
    }
    th {
        background:#e9e9e9;
    }
</style>
</head>
<body>

<h2>ANTES DO EXPEDIENTE</h2>
<table id="antes">
    <thead>
        <tr>
            <th>Motorista</th>
            <th>Data</th>
            <th>Horário</th>
            <th>Missão</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<h2>DEPOIS DO EXPEDIENTE</h2>
<table id="depois">
    <thead>
        <tr>
            <th>Motorista</th>
            <th>Data</th>
            <th>Horário</th>
            <th>Missão</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
// FUNÇÃO DEFINITIVA – AGORA FUNCIONA 100%
function formatarDataBruta(valor) {
    if (!valor) return "";

    valor = valor.toString().trim();

    let dia, mes, ano;

    // 1) dd/mm/yyyy ou dd-mm-yyyy
    if (/^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}$/.test(valor)) {
        let partes = valor.includes("/") ? valor.split("/") : valor.split("-");
        dia = partes[0];
        mes = partes[1];
        ano = partes[2].length === 2 ? "20" + partes[2] : partes[2]; 
        return `${dia.padStart(2,'0')}/${mes.padStart(2,'0')}/${ano}`;
    }

    // 2) dd/mm ou dd-mm  (SEM ANO → FORÇAR 2025)
    if (/^\d{1,2}[\/\-]\d{1,2}$/.test(valor)) {
        let partes = valor.includes("/") ? valor.split("/") : valor.split("-");
        dia = partes[0];
        mes = partes[1];
        return `${dia.padStart(2,'0')}/${mes.padStart(2,'0')}/2025`;
    }

    // SE NÃO RECONHECER, NÃO CRIA ANO 2001 — SOMENTE RETORNA O TEXTO ORIGINAL
    return valor;
}

// CARREGAR DADOS DAS DUAS ABAS
const url = "https://docs.google.com/spreadsheets/d/1eaFPPSEpMxsdUY9m3vT_fOhoYUKYBzATv55nRHQwyTY/gviz/tq?tqx=out:json";

fetch(url)
    .then(res => res.text())
    .then(text => {
        const json = JSON.parse(text.substring(47, text.length - 2));
        const linhas = json.table.rows;

        let antesBody = document.querySelector("#antes tbody");
        let depoisBody = document.querySelector("#depois tbody");

        linhas.forEach(linha => {
            if (!linha.c) return;

            let motorista  = linha.c[0]?.v || "";
            let data       = linha.c[1]?.v || "";
            let horario    = linha.c[2]?.v || "";
            let missao     = linha.c[3]?.v || "";
            let periodo    = linha.c[4]?.v || ""; // "ANTES" ou "DEPOIS"

            let dataFormatada = formatarDataBruta(data);

            let tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${motorista}</td>
                <td>${dataFormatada}</td>
                <td>${horario}</td>
                <td>${missao}</td>
            `;

            if (periodo.toUpperCase().includes("ANTES")) {
                antesBody.appendChild(tr);
            } else if (periodo.toUpperCase().includes("DEPOIS")) {
                depoisBody.appendChild(tr);
            }
        });
    });
</script>

</body>
</html>
