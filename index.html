<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Escala Motoristas</title>

<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f2f2f2;
        margin: 0;
        padding: 20px;
    }

    h2 {
        background: #003366;
        color: #fff;
        padding: 12px;
        border-radius: 6px;
        margin-top: 40px;
        font-size: 20px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        margin-top: 10px;
        border-radius: 6px;
        overflow: hidden;
    }

    th {
        background: #00509e;
        color: #fff;
        padding: 10px;
        font-size: 15px;
        text-align: left;
    }

    td {
        padding: 10px;
        border-bottom: 1px solid #ccc;
        font-size: 14px;
    }

    tr:nth-child(even) td {
        background: #f7f7f7;
    }
</style>
</head>
<body>

<h2>ANTES DO EXPEDIENTE</h2>
<table id="antes">
    <thead>
        <tr>
            <th>Motorista</th>
            <th>Data</th>
            <th>Horário</th>
            <th>Missão</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<h2>DEPOIS DO EXPEDIENTE</h2>
<table id="depois">
    <thead>
        <tr>
            <th>Motorista</th>
            <th>Data</th>
            <th>Horário</th>
            <th>Missão</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
// ----------------------
// PARSER DE DATA FINAL
// ----------------------
function formatarDataBruta(valor) {
    if (!valor) return "";

    valor = valor.toString().trim();

    let dia, mes, ano;

    // Formatos dd/mm/yyyy ou dd-mm-yyyy
    if (/^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4}$/.test(valor)) {
        let p = valor.includes("/") ? valor.split("/") : valor.split("-");
        dia = p[0];
        mes = p[1];
        ano = p[2].length === 2 ? "20" + p[2] : p[2];
        return `${dia.padStart(2,'0')}/${mes.padStart(2,'0')}/${ano}`;
    }

    // Formatos dd/mm ou dd-mm -> FORÇAR 2025
    if (/^\d{1,2}[\/\-]\d{1,2}$/.test(valor)) {
        let p = valor.includes("/") ? valor.split("/") : valor.split("-");
        dia = p[0];
        mes = p[1];
        return `${dia.padStart(2,'0')}/${mes.padStart(2,'0')}/2025`;
    }

    return valor;
}

// -------------------------
// BUSCA DA PLANILHA GOOGLE
// -------------------------
const url =
 "https://docs.google.com/spreadsheets/d/1eaFPPSEpMxsdUY9m3vT_fOhoYUKYBzATv55nRHQwyTY/gviz/tq?tqx=out:json";

fetch(url)
    .then(res => res.text())
    .then(data => {
        const json = JSON.parse(data.substring(47, data.length - 2));
        const linhas = json.table.rows;

        const antesBody = document.querySelector("#antes tbody");
        const depoisBody = document.querySelector("#depois tbody");

        linhas.forEach(l => {
            if (!l.c) return;

            let motorista = l.c[0]?.v || "";
            let data = l.c[1]?.v || "";
            let horario = l.c[2]?.v || "";
            let missao = l.c[3]?.v || "";
            let periodo = l.c[4]?.v || "";

            let dataFinal = formatarDataBruta(data);

            let tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${motorista}</td>
                <td>${dataFinal}</td>
                <td>${horario}</td>
                <td>${missao}</td>
            `;

            if (periodo.toUpperCase().includes("ANTES")) {
                antesBody.appendChild(tr);
            } else if (periodo.toUpperCase().includes("DEPOIS")) {
                depoisBody.appendChild(tr);
            }
        });
    });
</script>

</body>
</html>
