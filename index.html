<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="color-scheme" content="light">
<meta name="theme-color" content="#e8f7ff">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Contagem de Motoristas — Painel</title>
<link id="manifestPlaceholder" rel="manifest"/>

<style>
html { color-scheme: light; }

:root{
  --bg-1:#e8f7ff;
  --bg-2:#d8efff;
  --card-bg: rgba(255,255,255,0.72);
  --accent:#1e90ff;
  --muted:#234b60;
  --card-radius:16px;
  --shadow: 0 10px 30px rgba(11,36,64,0.10);
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: Inter, Segoe UI, Roboto, Arial, sans-serif;
  background: linear-gradient(180deg,var(--bg-1),var(--bg-2));
  color:var(--muted);
}

header{padding:26px 16px;text-align:center}
h1{margin:0;font-size:26px;color:var(--accent)}

.container{max-width:1100px;margin:18px auto 60px;padding:0 16px}

.panel{
  background:var(--card-bg);
  border-radius:var(--card-radius);
  padding:18px;
  margin:18px 0;
  box-shadow:var(--shadow);
}

.row{display:flex;gap:18px}
@media(max-width:880px){.row{flex-direction:column}}

.ranking-card{
  flex:1;
  border-radius:12px;
  padding:14px;
  color:#fff;
}
.rank-antes{background:linear-gradient(135deg,#50a8ff,#2b9ed8)}
.rank-depois{background:linear-gradient(135deg,#00b894,#01936b)}

.table-wrap{overflow:auto;margin-top:12px}
table{width:100%;border-collapse:collapse;background:#fff}
thead th{padding:12px;border-bottom:2px solid #ddd}
tbody td{padding:12px;border-bottom:1px solid #eee}

.top1{
  background:rgba(255,255,255,0.15);
  padding:8px;
  border-radius:8px;
  margin-bottom:8px;
}

/* ===== TÍTULOS DESTACADOS ===== */
.section-title{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 14px;
  margin:0 0 12px 0;
  font-size:18px;
  font-weight:700;
  color:var(--accent);
  background:rgba(30,144,255,0.12);
  border-left:6px solid var(--accent);
  border-radius:10px;
  box-shadow:var(--shadow);
}

@media (prefers-color-scheme: dark) {
  html, body {
    background: linear-gradient(180deg,#e8f7ff,#d8efff) !important;
    color: #234b60 !important;
  }
  .panel, table {
    background: rgba(255,255,255,0.95) !important;
  }
}
</style>
</head>

<body>
<header><h1>Contagem de Quadrinhos</h1></header>

<main class="container">
<div id="status" class="panel">Carregando dados...</div>

<section class="panel">
<div class="row">
  <div class="ranking-card rank-antes">
    <strong>Chegadas cedo — TOP 7</strong>
    <div id="rankListAntes"></div>
  </div>
  <div class="ranking-card rank-depois">
    <strong>Saídas tarde — TOP 7</strong>
    <div id="rankListDepois"></div>
  </div>
</div>
</section>

<section class="panel">
<h3 class="section-title">Registros — Antes do expediente</h3>
<div class="table-wrap">
<table id="tableAntes">
<thead><tr><th>Motorista</th><th>Data</th><th>Horário</th><th>Missão</th></tr></thead>
<tbody></tbody>
</table>
</div>
</section>

<section class="panel">
<h3 class="section-title">Registros — Depois do expediente</h3>
<div class="table-wrap">
<table id="tableDepois">
<thead><tr><th>Motorista</th><th>Data</th><th>Horário</th><th>Missão</th></tr></thead>
<tbody></tbody>
</table>
</div>
</section>
</main>

<script>
const SHEET_ID = "1eaFPPSEpMxsdUY9m3vT_fOhoYUKYBzATv55nRHQwyTY";
const ABA_ANTES = "ANTES DO EXPEDIENTE";
const ABA_DEPOIS = "DEPOIS DO EXPEDIENTE";
const BASE_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&sheet=`;

function dateToNumber(txt){
  if(!txt) return 0;
  const p = txt.split('/');
  if(p.length<3) return 0;
  let [d,m,y]=p;
  if(y.length===2) y='20'+y;
  return Number(`${y}${m.padStart(2,'0')}${d.padStart(2,'0')}`);
}

function sortByDate(items){
  return items.slice().sort((a,b)=>dateToNumber(b.data)-dateToNumber(a.data));
}

async function fetchSheet(aba){
  const r = await fetch(BASE_URL+encodeURIComponent(aba));
  const t = await r.text();
  const j = JSON.parse(t.slice(t.indexOf('{'),t.lastIndexOf('}')+1));
  return (j.table.rows||[]).map(r=>(r.c||[]).map(c=>c?.f||c?.v||""));
}

function normalize(rows){
  return rows.map(r=>({
    motorista:String(r[0]||""),
    data:String(r[1]||""),
    hora:String(r[2]||""),
    missao:String(r[3]||"")
  })).filter(r=>r.motorista);
}

function renderTable(id,items){
  const tb=document.querySelector(`#${id} tbody`);
  tb.innerHTML="";
  items.forEach(i=>{
    tb.innerHTML+=`<tr>
      <td>${i.motorista}</td>
      <td>${i.data}</td>
      <td>${i.hora}</td>
      <td>${i.missao}</td>
    </tr>`;
  });
}

function renderRanking(id,items){
  const c={};
  items.forEach(i=>c[i.motorista]=(c[i.motorista]||0)+1);
  const r=Object.entries(c).sort((a,b)=>b[1]-a[1]).slice(0,7);
  const el=document.getElementById(id);
  el.innerHTML="";
  r.forEach(([n,q],i)=>{
    el.innerHTML+=`<div class="${i===0?'top1':''}">
      ${i+1}. <strong>${n}</strong> — ${q}
    </div>`;
  });
}

async function loadAll(){
  const [a,b]=await Promise.all([
    fetchSheet(ABA_ANTES),
    fetchSheet(ABA_DEPOIS)
  ]);

  const na=sortByDate(normalize(a));
  const nb=sortByDate(normalize(b));

  renderTable("tableAntes",na);
  renderTable("tableDepois",nb);
  renderRanking("rankListAntes",na);
  renderRanking("rankListDepois",nb);

  document.getElementById("status").innerText="Dados carregados.";
}

loadAll();
</script>
</body>
</html>
